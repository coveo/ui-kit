name: 'Commit generated files'
description: 'Automatically commit generated files'

inputs:
  github-token:
    description: 'GitHub token'
    required: true

runs:
  using: composite
  steps:
    - run: |
        if [ ! -z "$(git status --porcelain)" ]; then
          git switch -c gh_temp/${{ github.head_ref }}
          git add 'packages/atomic/**/*.d.ts' 'packages/atomic-hosted-page/**/*.d.ts' 'packages/atomic-react/src/components/stencil-generated/*' 'packages/atomic-angular/projects/atomic-angular/src/lib/stencil-generated/*'

          git config --global user.name "GitHub Actions Bot"
          git config --global user.email "<>"
          git commit -m "Add generated files"
          git push --set-upstream origin gh_temp/${{ github.head_ref }} -f

          gh pr new -B ${{github.head_ref}} -H gh_temp/${{github.head_ref}} -t "Add generated files" -b "Add generated files"
          gh pr merge -s -t "Add generated files"
        fi
      shell: bash
      env:
        GH_TOKEN: ${{ inputs.github-token }}
