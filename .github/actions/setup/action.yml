name: "Setup & build"
description: "Setup node, install dependencies & build"
runs:
  using: composite
  steps:
    - uses: actions/setup-node@v2
      with:
        node-version-file: '.nvmrc'
    - uses: actions/cache@v2
      id: build-cache
      with:
        path: |
          packages/bueno
          packages/headless
          packages/auth
          packages/atomic
          packages/samples/headless-react
          !node_modules
          !**/node_modules
        key: ${{ github.sha }}
    - uses: actions/cache@v2
      with:
        path: |
          node_modules
          **/node_modules
        key: ${{ hashFiles('**/package-lock.json') }}
    - run: |
        npm ci
        npx lerna bootstrap --ci
      shell: bash
    - if: steps.build-cache.outputs.cache-hit != 'true'
      run: npm run build
      shell: bash