name: Quantic Promote Package Workflow

env: 
  SFDX_AUTH_JWT_INSTANCE_URL: https://login.salesforce.com
  SFDX_AUTH_JWT_USERNAME: sfdc.integration.devv2.hub@coveo.com
  SFDX_AUTH_JWT_KEY: ${{ secrets.SFDX_AUTH_JWT_KEY_DEV }}
  SFDX_AUTH_JWT_CLIENT_ID: 3MVG9LBJLApeX_PDlEni7JUnKtxHybHKI_12BhenOY_Av5vP6uR_vGdaNRelKFKaltSVpU3WvrRnaLqr6xeiZ
  SFDX_NAMESPACE: CoveoV2Dev
  PACKAGE_ID: 0Ho6g000000Kz2sCAC

on: workflow-dispatch

defaults:
  run:
    shell: bash

jobs: 
  name: Package Version Promote
  runs-on: ubuntu-latest
  steps:
    - name: Use Node.js 14.x
      uses: actions/setup-node@v1
      with: 
        node-version: 14.x
  - name: Check Out Repository
    uses: actions/checkout@v2
  # Install NPM dependencies
  - run: npm i -g sfdx-cli
    shell: bash
  # Connect to DevHub organization
  - run: sfdx force:auth:jwt:grant --clientid $SFDX_AUTH_JWT_CLIENT_ID --jwtkeyfile server.key --username $SFDX_AUTH_JWT_USERNAME --setdefaultdevhubusername
    shell: bash
  # Promote package version in the Dev Hub org
  - run: sfdx force:package:version:promote -p $PACKAGE_ID
    shell: bash
  # Retrieve package details in the Dev Hub org
  - run: sfdx force:package:version:report -p $PACKAGE_ID
    shell: bash