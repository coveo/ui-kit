node('linux && docker') {
  checkout scm

  parameters {
    string(name: 'VERSION')
  }

  withEnv(['npm_config_cache=npm-cache', 'CI=true']) {
    withDockerContainer(image: 'node:14', args: '-u=root') {
      stage('Setup') {
        sh 'npm run setup'
      }

      stage('Graduate') {
        print "GRADUATE SCRIPT VERSION = ${params.VERSION}"
      }

      stage('Npm publish') {
        withCredentials([
        string(credentialsId: 'NPM_TOKEN', variable: 'NPM_TOKEN')]) {
          print "PUBLISH"
        }
      }
    }
  }
}