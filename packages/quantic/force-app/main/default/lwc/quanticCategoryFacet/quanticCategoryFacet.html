<template>
    <template if:true={hasParentsOrValues}>
        <c-quantic-card-container title={label}>
            <lightning-button-icon
                class="slds-var-p-bottom_small"
                slot="actions"
                onclick={toggleFacetVisibility}
                icon-name={actionButtonIcon}
                alternative-text={actionButtonLabel}
                variant="bare">
            </lightning-button-icon>
            <template if:true={isExpanded}>
                <ul class="slds-has-dividers_around-space slds-m-vertical_xx-small">
                    <template if:false={noSearch}>
                        <div onchange={handleKeyUp} class="slds-size_1-of-1">
                        <lightning-input class="facet__searchbox-input slds-var-m-horizontal_small slds-var-p-bottom_x-small" name={labels.search} type="search" label="facet-input" variant="label-hidden" placeholder={labels.search}></lightning-input>
                        </div>
                    </template>
                    <template if:false={isFacetSearchActive}>
                        <template if:true={hasParents}>
                            <li class="slds-var-m-vertical_small slds-var-m-horizontal_small slds-grid">
                                <div onclick={reset}>
                                    <lightning-button-icon variant="bare" icon-name="utility:chevronleft"></lightning-button-icon>
                                    <span class="nowrap">{labels.allCategories}</span>
                                </div> 
                            </li> 
                         </template>
                         <template for:each={nonActiveParents} for:item="v">
                            <c-quantic-category-facet-value onselectvalue={onSelect} key={v.value} item={v} nonactiveparent="true"></c-quantic-category-facet-value>
                         </template>
                         <template if:true={activeParent}>
                             <li class="slds-grid slds-var-m-horizontal_small slds-var-m-vertical_xx-small">
                                 <span class="nowrap parent-text__bold">{activeParent.value}</span>
                                 <span class="facet__number-of-results parent-text__bold">({activeParent.numberOfResults})</span>
                             </li>  
                         </template>
                         <li class="slds-grid">
                            <ul>
                             <template for:each={values} for:item="v">
                                <c-quantic-category-facet-value 
                                    onselectvalue={onSelect} 
                                    key={v.value} 
                                    item={v}
                                    activeparent={activeParent}>
                                </c-quantic-category-facet-value>
                             </template>
                            </ul>
                         </li>
                    </template>
                    <template if:true={isFacetSearchActive}>
                        <template if:true={hasSearchResults}>
                            <template for:each={facetSearchResults} for:item="result">
                                <c-quantic-category-facet-value 
                                    onselectvalue={onSelect} 
                                    key={result.value}  
                                    item={result} 
                                    withsearch="true">
                                </c-quantic-category-facet-value>
                            </template>
                        </template>
                        <template if:false={hasSearchResults}>
                            <li class="slds-var-m-around_small slds-grid">
                                <span class="slds-align_absolute-center slds-var-p-vertical_small slds-var-m-bottom_medium slds-var-p-horizontal_xx-large facet__search-results_no-match">{noMatchesForLabel}</span>
                            </li>
                        </template>
                        <template if:true={canShowMoreSearchResults}>
                            <li class="slds-var-p-left_small slds-var-p-bottom_medium">
                                <span class="facet__search-results_more-matches">{moreMatchesForLabel}</span> 
                            </li>
                        </template>
                    </template>
                </ul>
                <template if:true={canShowLess}>
                    <button variant="base" label={labels.showLess}
                      class="slds-var-m-left_x-small facet__show-less" onclick={showLess}>
                      <span class="facet__show-less-text">{labels.showLess}</span>
                    </button>
                </template>
                <template if:true={canShowMore}>
                    <button variant="base" label={labels.showMore}
                      class="slds-var-m-left_x-small facet__show-more" onclick={showMore}>
                      <span class="facet__show-more-text">{labels.showMore}</span>
                    </button>
                </template> 
            </template>
        </c-quantic-card-container>
    </template>
</template>
