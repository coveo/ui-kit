import { Meta } from '@storybook/addon-docs/blocks';
import * as AtomicInsightInterfaceStories from '../atomic-insight-interface/atomic-insight-interface.new.stories';
import { AtomicDocTemplate } from '@/storybook-utils/documentation/atomic-doc-template';

<Meta title="Atomic/Insight/ResultTemplate" />

# atomic-insight-result-template

The `atomic-insight-result-template` component defines the UI display of your search results within an Insight interface.

A `template` element must be the child of an `atomic-insight-result-template`. Furthermore, an `atomic-insight-result-list` or `atomic-insight-folded-result-list` must be the parent of each `atomic-insight-result-template`.

**Note:** Any `<script>` tags that are defined inside a `<template>` element will not be executed when the results are being rendered.

## Usage

Example using the `atomic-insight-result-list`:

```html
<atomic-insight-interface>
  <atomic-insight-result-list>
    <atomic-insight-result-template>
      <template>
        <atomic-result-section-visual>
          <atomic-result-image field="ytthumbnailurl" fallback="https://picsum.photos/seed/picsum/350"></atomic-result-image>
        </atomic-result-section-visual>
        
        <atomic-result-section-badges>
          <atomic-field-condition must-match-sourcetype="YouTube">
            <atomic-result-badge
              label="YouTube"
              class="youtube-badge"
            ></atomic-result-badge>
          </atomic-field-condition>
        </atomic-result-section-badges>

        <atomic-result-section-title>
          <atomic-result-link></atomic-result-link>
        </atomic-result-section-title>

        <atomic-result-section-excerpt>
          <atomic-result-text field="excerpt"></atomic-result-text>
        </atomic-result-section-excerpt>

        <atomic-result-section-bottom-metadata>
          <atomic-result-fields-list>
            <atomic-field-condition class="field" if-defined="source">
              <span class="field-label">
                <atomic-text value="source"></atomic-text>:
              </span>
              <atomic-result-text field="source"></atomic-result-text>
            </atomic-field-condition>
            
            <atomic-field-condition class="field" if-defined="author">
              <span class="field-label">
                <atomic-text value="author"></atomic-text>:
              </span>
              <atomic-result-text field="author"></atomic-result-text>
            </atomic-field-condition>
            
            <atomic-field-condition class="field" if-defined="date">
              <span class="field-label">
                <atomic-text value="date"></atomic-text>:
              </span>
              <atomic-result-date></atomic-result-date>
            </atomic-field-condition>
          </atomic-result-fields-list>
        </atomic-result-section-bottom-metadata>
      </template>
    </atomic-insight-result-template>
  </atomic-insight-result-list>
</atomic-insight-interface>
```

## Template Conditions

You can use conditions to display different templates based on result properties. You can specify as many `must-match-*` and `must-not-match-*` attributes as you want on a template, each targeting a different field. Each attribute can accept multiple comma-separated values.

**Comma represents OR:** Within a single attribute, comma-separated values represent a logical OR. For example, `must-match-sourcetype="YouTube,Salesforce"` means the sourcetype must be YouTube OR Salesforce.

**Multiple attributes represent AND:** All conditions from different attributes must be met (logical AND) for the template to apply to a result.

If you set both `must-match-*` and `must-not-match-*` for the same field and there is any overlap in values, the template will be ignored (it will never match any result).

**Order of declaration matters:** The first template whose conditions are met will be applied. If a default template (without conditions) is declared first, it will apply to all results, even if other templates with conditions are declared later.

### Examples

```html
<!-- Template applies if sourcetype is YouTube or Salesforce, and language is NOT fr -->
<atomic-insight-result-template
  must-match-sourcetype="YouTube,Salesforce"
  must-not-match-language="fr"
>
  <template>
    <!-- ... -->
  </template>
</atomic-insight-result-template>

<!-- This template will never apply, because the same value is required and forbidden -->
<atomic-insight-result-template
  must-match-sourcetype="YouTube"
  must-not-match-sourcetype="YouTube"
>
  <template>
    <!-- ... -->
  </template>
</atomic-insight-result-template>
```

### Multiple Templates Example

```html
<atomic-insight-result-list>
  <!-- Template for YouTube videos -->
  <atomic-insight-result-template must-match-sourcetype="YouTube">
    <template>
      <atomic-result-section-visual>
        <atomic-result-image field="ytthumbnailurl"></atomic-result-image>
      </atomic-result-section-visual>
      <atomic-result-section-title>
        <atomic-result-link></atomic-result-link>
      </atomic-result-section-title>
      <atomic-result-section-excerpt>
        <atomic-result-text field="excerpt"></atomic-result-text>
      </atomic-result-section-excerpt>
    </template>
  </atomic-insight-result-template>

  <!-- Default template for all other results -->
  <atomic-insight-result-template>
    <template>
      <atomic-result-section-title>
        <atomic-result-link></atomic-result-link>
      </atomic-result-section-title>
      <atomic-result-section-excerpt>
        <atomic-result-text field="excerpt"></atomic-result-text>
      </atomic-result-section-excerpt>
    </template>
  </atomic-insight-result-template>
</atomic-insight-result-list>
```

## Properties

### conditions

A function that must return true on results for the result template to apply. Set programmatically before initialization, not via attribute.

For example, the following targets a template and sets a condition to make it apply only to results whose `title` contains `singapore`:

```javascript
document.querySelector('#target-template').conditions = [
  (result) => /singapore/i.test(result.title)
];
```

### must-match-*

The field and values that define which result items the condition must be applied to.

For example, a template with the following attribute only applies to result items whose `filetype` is `lithiummessage` or `YouTubePlaylist`:

```html
<atomic-insight-result-template must-match-filetype="lithiummessage,YouTubePlaylist">
```

### must-not-match-*

The field and values that define which result items the condition must not be applied to.

For example, a template with the following attribute only applies to result items whose `filetype` is not `lithiummessage`:

```html
<atomic-insight-result-template must-not-match-filetype="lithiummessage">
```

## Methods

### getTemplate()

Gets the appropriate result template based on conditions applied.

Returns: `Promise<InsightResultTemplate<DocumentFragment> | null>`

## Related Components

- [atomic-insight-result-list](../?path=/docs/atomic-insight-resultlist--docs)
- [atomic-insight-folded-result-list](../?path=/docs/atomic-insight-foldedresultlist--docs)
- [atomic-insight-interface](../?path=/docs/atomic-insight-interface--docs)
